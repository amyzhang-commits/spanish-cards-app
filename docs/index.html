<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Spanish Verb Trainer - Offline First</title>

    <!-- PWA Meta Tags -->
    <meta name="description" content="Offline-first Spanish verb conjugation trainer with Anki-style flashcards">
    <meta name="theme-color" content="#1e40af">
    <link rel="manifest" href="manifest.json">

    <!-- Icons for PWA -->
    <link rel="icon" type="image/x-icon" href="icons/favicon.ico">
    <link rel="apple-touch-icon" href="icons/icon-192.png">

    <!-- Styles -->
    <link rel="stylesheet" href="css/style.css">
</head>
<body>
    <div class="container">
        <!-- Offline Status Indicator -->
        <div id="offlineIndicator" class="offline-indicator" style="display: none;">
            📱 Working Offline
        </div>

        <!-- Sync Status Indicator -->
        <div id="syncIndicator" class="sync-indicator" style="display: none;">
            🔄 Syncing...
        </div>

        <header>
            <h1>🇪🇸 <span class="gradient-text">Spanish Verb Trainer</span></h1>
            <div class="status-bar">
                <span id="cardCount">0 cards stored locally</span>
                <span id="syncStatus">Ready</span>
            </div>
            <nav>
                <a href="index.html" class="nav-link active">Generate Verbs</a>
                <a href="sentences.html" class="nav-link">Process Sentences</a>
                <a href="study.html" class="nav-link">Study Cards</a>
                <a href="manage.html" class="nav-link">Manage Cards</a>
            </nav>
        </header>

        <main>
            <!-- Reference Section -->
            <section class="reference-section">
                <h2>📚 Spanish Tenses & Moods Reference</h2>
                <p>Learn about Spanish conjugation patterns before generating your flashcards</p>

                <div class="reference-grid">
                    <div class="mood-group">
                        <h3>📊 Indicative Mood</h3>
                        <p class="mood-description">States facts, describes reality</p>

                        <div class="tense-list">
                            <div class="tense-item">
                                <h4>Present Indicative</h4>
                                <p>Describes actions happening now or habitual actions</p>
                                <small>Example: "Me cuesta mucho estudiar" (It's very difficult for me to study)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Preterite</h4>
                                <p>Completed actions in the past with specific time</p>
                                <small>Example: "Su comentario dio en el clavo" (His comment hit the nail on the head)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Imperfect</h4>
                                <p>Ongoing or habitual actions in the past</p>
                                <small>Example: "Solía correr todas las mañanas" (I used to run every morning)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Future</h4>
                                <p>Actions that will happen in the future</p>
                                <small>Example: "Lo veré venir" (I'll see it coming)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Present Perfect</h4>
                                <p>Actions completed recently or with present relevance</p>
                                <small>Example: "He comido como un rey" (I've eaten like a king)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Past Perfect</h4>
                                <p>Actions completed before another past action</p>
                                <small>Example: "Había llovido sobre mojado" (It had rained on wet ground - things going from bad to worse)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Future Perfect</h4>
                                <p>Actions that will be completed before a future point</p>
                                <small>Example: "Habré terminado para entonces" (I will have finished by then)</small>
                            </div>
                        </div>
                    </div>

                    <div class="mood-group">
                        <h3>🤔 Subjunctive Mood</h3>
                        <p class="mood-description">Expresses doubt, emotion, desire, or hypothetical situations</p>

                        <div class="tense-list">
                            <div class="tense-item">
                                <h4>Present Subjunctive</h4>
                                <p>Used with present-time expressions of doubt or emotion</p>
                                <small>Example: "Que te vaya bien" (I hope it goes well for you)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Imperfect Subjunctive</h4>
                                <p>Used with past-time expressions of doubt or emotion</p>
                                <small>Example: "Si yo fuera rico…" (If I were rich…)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Future Subjunctive</h4>
                                <p>Rarely used, found in legal texts and proverbs</p>
                                <small>Example: "Si alguien hablare mal de ti…" (If someone speaks badly of you…)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Present Perfect Subjunctive</h4>
                                <p>Completed actions in contexts requiring subjunctive</p>
                                <small>Example: "Espero que hayas estudiado bien" (I hope you have studied well)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Past Perfect Subjunctive</h4>
                                <p>Past completed actions in hypothetical contexts</p>
                                <small>Example: "Si hubiera sabido, habría venido" (If I had known, I would have come)</small>
                            </div>
                        </div>
                    </div>

                    <div class="mood-group">
                        <h3>💭 Conditional Mood</h3>
                        <p class="mood-description">Expresses hypothetical or polite situations</p>

                        <div class="tense-list">
                            <div class="tense-item">
                                <h4>Simple Conditional</h4>
                                <p>What would happen under certain conditions</p>
                                <small>Example: "Yo que tú, hablaría con él" (If I were you, I would talk to him)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Perfect Conditional</h4>
                                <p>What would have happened in the past</p>
                                <small>Example: "Habría llegado antes, pero me retrasé" (I would have arrived earlier, but I was delayed)</small>
                            </div>
                        </div>
                    </div>

                    <div class="mood-group">
                        <h3>⚡ Imperative Mood</h3>
                        <p class="mood-description">Gives commands, requests, or instructions</p>

                        <div class="tense-list">
                            <div class="tense-item">
                                <h4>Affirmative Imperative</h4>
                                <p>Positive commands and requests</p>
                                <small>Example: "¡Di la verdad!" (Tell the truth!)</small>
                            </div>

                            <div class="tense-item">
                                <h4>Negative Imperative</h4>
                                <p>Negative commands using subjunctive forms</p>
                                <small>Example: "¡No digas tonterías!" (Don't talk nonsense!)</small>
                            </div>
                        </div>
                    </div>
                </div>
            </section>

            <section class="generator-section">
                <h2>Verb Conjugation Generator</h2>
                <p>Generate targeted flashcards for specific tenses and moods - works completely offline!</p>

                <div class="input-section">
                    <form id="verbForm">
                        <div class="form-group">
                            <label for="verbInput">Spanish Verb:</label>
                            <input
                                type="text"
                                id="verbInput"
                                placeholder="e.g., hablar, ser, soler..."
                                required
                                autocomplete="off"
                            >
                        </div>
                        <button type="submit" id="generateBtn">
                            <span class="btn-text">Choose Card Type</span>
                            <span class="spinner" style="display: none;">🧠</span>
                        </button>
                    </form>
                </div>

                <!-- Loading Section -->
                <div id="loadingSection" class="loading-section" style="display: none;">
                    <div class="loading-animation">
                        <div class="spinner-large">🧠</div>
                        <p id="loadingText">Analyzing verb...</p>
                        <small id="loadingSubtext">This may take 10-30 seconds</small>
                    </div>
                </div>

                <!-- Generation Options Section -->
                <div id="generationSection" class="generation-section" style="display: none;">
                    <div class="verb-generation">
                        <h3 id="generationTitle">Generate Cards</h3>

                        <div class="generation-form">
                            <div class="form-group">
                                <label for="tenseMoodSelect">Choose Tense & Mood:</label>
                                <select id="tenseMoodSelect" class="tense-mood-select">
                                    <option value="">Select a tense and mood...</option>

                                    <optgroup label="📝 Simple Cards">
                                        <option value="meaning_only">Meaning Card (translation only)</option>
                                    </optgroup>

                                    <optgroup label="📊 Indicative Mood">
                                        <option value="present_indicative">Present Indicative</option>
                                        <option value="preterite_indicative">Preterite</option>
                                        <option value="imperfect_indicative">Imperfect</option>
                                        <option value="future_indicative">Future</option>
                                        <option value="present_perfect_indicative">Present Perfect</option>
                                        <option value="past_perfect_indicative">Past Perfect</option>
                                        <option value="future_perfect_indicative">Future Perfect</option>
                                    </optgroup>

                                    <optgroup label="🤔 Subjunctive Mood">
                                        <option value="present_subjunctive">Present Subjunctive</option>
                                        <option value="imperfect_subjunctive">Imperfect Subjunctive</option>
                                        <option value="future_subjunctive">Future Subjunctive</option>
                                        <option value="present_perfect_subjunctive">Present Perfect Subjunctive</option>
                                        <option value="past_perfect_subjunctive">Past Perfect Subjunctive</option>
                                    </optgroup>

                                    <optgroup label="💭 Conditional Mood">
                                        <option value="simple_conditional">Simple Conditional</option>
                                        <option value="perfect_conditional">Perfect Conditional</option>
                                    </optgroup>

                                    <optgroup label="⚡ Imperative Mood">
                                        <option value="affirmative_imperative">Affirmative Imperative</option>
                                        <option value="negative_imperative">Negative Imperative</option>
                                    </optgroup>
                                </select>
                            </div>

                            <button id="generateCardsBtn" class="btn-primary" disabled>
                                🔥 Generate Cards
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Results Section -->
                <div id="resultsSection" class="results-section" style="display: none;">
                    <div class="conjugations-preview">
                        <h4>Generated Cards Preview</h4>
                        <div class="stats">
                            <span id="generatedCount">0 cards generated</span>
                        </div>

                        <div class="preview-grid" id="previewGrid">
                            <!-- Cards will be inserted here -->
                        </div>

                        <div class="action-buttons">
                            <button id="saveBtn" class="btn-primary">
                                💾 Save Cards Locally
                            </button>
                            <button id="generateAnotherBtn" class="btn-secondary">
                                ➕ Generate Another Verb
                            </button>
                        </div>
                    </div>
                </div>

                <!-- Error Section -->
                <div id="errorSection" class="error-section" style="display: none;">
                    <div class="error-message">
                        <h4>❌ Generation Failed</h4>
                        <p id="errorText"></p>
                        <div class="error-actions">
                            <button id="retryBtn" class="btn-secondary">Try Again</button>
                            <button id="offlineBtn" class="btn-secondary" style="display: none;">
                                📱 Use Offline Mode
                            </button>
                        </div>
                    </div>
                </div>

                <!-- PWA Install Prompt -->
                <div id="installPrompt" class="install-prompt" style="display: none;">
                    <div class="install-card">
                        <h4>📱 Install App</h4>
                        <p>Install Spanish Verb Trainer for offline access and better performance!</p>
                        <div class="install-actions">
                            <button id="installBtn" class="btn-primary">Install App</button>
                            <button id="dismissInstallBtn" class="btn-secondary">Maybe Later</button>
                        </div>
                    </div>
                </div>
            </section>
        </main>
    </div>

    <!-- Scripts -->
    <script src="js/db.js"></script>
    <script src="js/sync.js"></script>
    <script src="js/app.js"></script>

    <!-- PWA Registration -->
    <script>
        // Register service worker
        if ('serviceWorker' in navigator) {
            window.addEventListener('load', () => {
                navigator.serviceWorker.register('sw.js')
                    .then((registration) => {
                        console.log('SW registered: ', registration);
                    })
                    .catch((registrationError) => {
                        console.log('SW registration failed: ', registrationError);
                    });
            });
        }

        // Handle PWA install prompt
        let deferredPrompt;
        window.addEventListener('beforeinstallprompt', (e) => {
            e.preventDefault();
            deferredPrompt = e;
            document.getElementById('installPrompt').style.display = 'block';
        });

        document.getElementById('installBtn').addEventListener('click', async () => {
            if (deferredPrompt) {
                deferredPrompt.prompt();
                const { outcome } = await deferredPrompt.userChoice;
                console.log(`User response to the install prompt: ${outcome}`);
                deferredPrompt = null;
                document.getElementById('installPrompt').style.display = 'none';
            }
        });

        document.getElementById('dismissInstallBtn').addEventListener('click', () => {
            document.getElementById('installPrompt').style.display = 'none';
        });
    </script>

    <!-- Debug Sync Button -->
    <button onclick="testSync()" style="position: fixed; bottom: 20px; right: 20px; z-index: 9999; padding: 20px; background: red; color: white; font-size: 18px;">
        TEST SYNC
    </button>

    <script>
    async function testSync() {
        alert('Sync endpoint: ' + syncEngine.syncEndpoint);
        alert('Online: ' + navigator.onLine);
        const unsyncedCards = await cardDB.getUnsyncedCards();
        alert('Unsynced cards: ' + unsyncedCards.length);
        const allCards = await cardDB.getCards();
        alert('Total cards in IndexedDB: ' + allCards.length);
        await syncEngine.syncCards();
        alert('Sync attempted!');
    }
    </script>
</body>
</html>